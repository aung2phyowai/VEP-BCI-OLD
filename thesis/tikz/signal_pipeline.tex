\tikzstyle{decision} = [diamond, draw, fill=blue!20,
    text width=4.5em, text badly centered, inner sep=0pt]
\tikzstyle{block} = [rectangle, draw, fill=blue!20,
    text width=5em, text centered, rounded corners, minimum height=4em]
\tikzstyle{line} = [draw, very thick, color=black!50, -latex']
\tikzstyle{cloud} = [draw, ellipse,fill=red!20, 
    minimum height=2em]

\begin{tikzpicture}[scale=2, node distance = 4cm, auto]
	% Nodes
	\node [cloud] (start) {start};
	\node [block, right of=start] (length) {wait for \texttt{length} packets};
	\node [decision, below of=length, node distance=2.7cm] (received) {received "Stop"?};
	\node [block, left of=received] (step) {wait for \texttt{step} packets};
	\node [block, right of=received] (filter) {filter new signal segment};
	\node [block, right of=filter] (add) {add the segment to signal};
	\node [cloud, above of=filter, node distance=2.7cm] (stop) {stop};
	\node [block, below of=add, node distance=2.7cm] (delete) {delete first \texttt{step} packets};
	\node [block, left of=delete] (detrend) {make copy of signal};
	\node [block, left of=detrend] (window) {detrend~and window the signal};
	\node [block, left of=window] (detect) {send signal to feature extraction or to plot};
	
	% Arrows
	\path [line] (start) -- (length);
	\path [line] (length) -- (received);
	\path [line] (step) -- (received);
	\path [line] (received) -- node [near start, color=black] {yes} (stop);
	\path [line] (received) -- node [near start, color=black] {no} (filter);
	\path [line] (filter) -- (add);
	\path [line] (add) -- (delete);
	\path [line] (detrend) -- (window);
	\path [line] (delete) -- (detrend);
	\path [line] (window) -- (detect);
	\path [line] (detect) -- (step);
	
\end{tikzpicture}
