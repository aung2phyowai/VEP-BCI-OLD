
\chapter{VEP-based brain-computer interface}

The previous chapter discussed the biology of the human brain and described the brain potential called \gls{SSVEP}. The aim of this chapter is to describe which kind of visual stimuli can be used to elicit \gls{SSVEP} and how to detect \gls{SSVEP} in a \gls{EEG} recording. This knowledge is needed to extract information from the \gls{EEG} recording and use this information to control a robot. In other words, this chapter will discuss how to implement a \gls{VEP}-based \gls{BCI}.

\section{Visual stimulus}
\label{sec:stimuli}

As discussed in section~\ref{sec:VEP}, it is possible to present multiple visual stimuli to a subject and detect, which stimulus is the subject looking at. It was also mentioned that computer monitor can be used to present visual stimuli. This section will discuss how stimuli with certain blinking frequency can be displayed on a computer screen. Research has shown that LCD screens produce more accurate stimuli than light-emitting diodes~\cite{lcd_lcd_led}. In this thesis only the stimulus that can be presented by a computer monitor is discussed.

A computer monitor has certain size, resolution and refresh rate. Monitor resolution and size limit the size of the visual stimuli that can be used and the distance between the stimuli. Monitor refresh rate, on the other hand, limits the blinking frequency of the stimulus that can be used. Research has shown that LCD screens produce more accurate stimuli when using the monitor refresh rate for synchronisation rather than a timer~\cite{lcd_lcd_led}. In this thesis, monitor refresh rate is used for synchronisation.

Monitor refresh rate is the number of consecutive images or frames shown on screen in a second, assuming that the frames are produces at least as fast as they can be displayed. A frame is one of the images that compose the changing picture on screen. Monitor with a refresh rate of 60 Hz can display 60 frames per second. 

The blinking of a target is called \gls{flickering}. Often, \gls{flickering} one-coloured squares on one-coloured background are used as visual stimuli in \gls{SSVEP}-based \glspl{BCI}~\cite{ssvep_stim}. The squares may have symbols on them, for example letters or numbers. The stimuli of \gls{VEP}-based \gls{BCI} are also called \glspl{target}.

In every frame each \gls{target} can be in one of two states---displayed or not displayed. The state of a \gls{target} can be changed only when the frame changes. The states of a \gls{target} over time can be represented with a function of state versus time:
\begin{equation}
	\label{eq:state_vs_time}
	y(t)=
	\begin{cases}
		1,	&\mbox{if the \gls{target} is displayed on the screen at time t}\\
		0,	&\mbox{if the \gls{target} is not displayed on the screen at time t}
	\end{cases}
\end{equation}
See figure~\ref{fig:square_waves} for example. The function~$y(t)$ has to be periodic and the state switches should be distributed as evenly as possible over the period of the function for the target frequency to be constant.

The fastest possible target frequency can be achieved by changing between on and off states of the target every time a new frame is displayed. If the state is changed at lower rate, the \gls{target} frequency will also be lower. Perhaps it is most reasonable to calculate the \gls{target} frequency with:
\begin{equation}
	f = \frac{n}{2T}
\end{equation}
where T is the period of the function~$y(t)$, n is the number of times the target state is switched in a time period of T and f is the target frequency.

The \gls{flickering} of a \gls{target} can be divided into three categories. If the refresh rate divided by target frequency is 
\begin{enumerate}
	\item[a.] even, then it is easy to divide \gls{flickering} among frame changes;
	\item[b.] odd, then the \gls{flickering} has to be adjusted so that the amounts of time the target is displayed and not displayed are not equal; or
	\item[c.] not a natural number, then the \gls{flickering} has to be even more irregular than in case~b.
\end{enumerate}

If the monitor refresh rate is 60 Hz, then the flickering of 10 Hz corresponds to case~a, 12 Hz corresponds to case~b and 11 Hz corresponds to case~c. Although the 11 Hz flickering produces irregular flickering \cite{11hz}, it is still possible to detect \gls{SSVEP} elicited by it in the Emotiv EPOC recording~\cite{emotiv_11hz}.

%In conclusion, the visual stimuli used in \gls{VEP}-based \gls{BCI} can be produced by a computer monitor and the synchronisation of the flickering can be based on refresh rate.

\begin{figure}[h]
	\centering
	\begin{subfigure}{\textwidth}
		\includegraphics[width=\textwidth]{square_wave_10.png}
		\caption{Square wave with fundamental frequency of 10 Hz}
		\label{fig:square_10}
	\end{subfigure}\vspace{10pt}
	\begin{subfigure}{\textwidth}
		\includegraphics[width=\textwidth]{square_wave_11.png}
		\caption{Square wave with fundamental frequency of 11 Hz}
		\label{fig:square_11}
	\end{subfigure}\vspace{10pt}
	\begin{subfigure}{\textwidth}
		\includegraphics[width=\textwidth]{rect_wave_11.png}
		\caption{11 Hz square wave adjusted to refresh rate}
		\label{fig:rect_11}
	\end{subfigure}\vspace{10pt}
	\begin{subfigure}{\textwidth}
		\includegraphics[width=\textwidth]{square_wave_12.png}
		\caption{Square wave with fundamental frequency of 12 Hz}
		\label{fig:square_12}
	\end{subfigure}\vspace{10pt}
	\begin{subfigure}{\textwidth}
		\includegraphics[width=\textwidth]{rect_wave_12.png}
		\caption{12 Hz square wave adjusted to refresh rate}
		\label{fig:rect_12}
	\end{subfigure}
	\caption{The flickering of targets represented by a function of state versus time. Vertical grid lines represent the frame changes with 60 Hz refresh rate.}
	\label{fig:square_waves}
\end{figure}

\section{Fourier analysis}
\label{sec:fourier}

As discussed in the previous section, the flickering of a target can produce three different waveforms. Now we will discuss how these waveforms can be represented by sums of simpler trigonometric functions. The study of this decomposition process is called Fourier analysis, named after Joseph Fourier, whose insight to model all functions by trigonometric series was a breakthrough in the field in 1807.

The decomposition process itself is called Fourier transform and it is used to decompose a function of time into the frequencies that make it up. The Fourier transform is a function of frequency and its values are complex numbers. The amount of frequency x present in a function of time can be calculated by taking the absolute value of the Fourier transform's value at frequency x. The absolute value of a complex number $z=a+ib$ is defined as:
\begin{equation}
	|z|=\sqrt{a^2+b^2}
\end{equation}
Since we are working with discrete signal as discussed in section~\ref{sec:EEG_comparison}, we will use the discrete Fourier transform. The algorithm used to compute the discrete Fourier transform is called \gls{FFT}.

\section{Related work}

There are many types of \glspl{BCI} available. A review by Bashashati \textit{et al.}~\cite{bci_comparison} contains a good overview of \gls{EEG}-based \glspl{BCI}. Their paper includes overview of the following neuromechanisms used in \gls{EEG}-based \glspl{BCI}: \gls{VEP} and \gls{SSVEP}, P300, slow cortical potential, response to mental task, sensorimotor activity, and multiple neuromechanisms or hybrid \gls{BCI}. Hybrid \gls{BCI} uses two different neuromechanisms in a \gls{BCI} and therefore two different methods are required to analyse \gls{EEG} recording~\cite{hybrid_bci, hybrid_bci2}. %In this thesis, main focus is on \gls{SSVEP}-based \glspl{BCI}. 

\gls{SSVEP}-based \glspl{BCI} can be divided in categories according to the method used to detect \glspl{SSVEP} in \gls{EEG} recording. These methods are also called \gls{feature extraction} methods. Current \gls{SSVEP}-based \gls{BCI} \gls{feature extraction} methods include:
\begin{itemize}
	\item \Gls{PSDA} method introduced by Cheng \textit{et al.}~\cite{psda}.
	\item \Gls{SC} method introduced by Wu and Yao~\cite{sc}.
	\item \Gls{MEC} method introduced by Friman \textit{et al.}~\cite{mec}. This method has shown better performance than \gls{SC} and \gls{PSDA} method~\cite{mec_comparison}.
	\item \Gls{CCA} method introduced by Lin \textit{et al.}~\cite{cca_lin}. This method has shown better performance than \gls{PSDA} method~\cite{cca_psda, bin2009cca, cca_lin}.
	\item \Gls{LASSO} method introduced by Zhang \textit{et al.}~\cite{LASSO}. This method has shown better performance than \gls{CCA} method~\cite{LASSO}.
	\item \Gls{LRT} method introduced by Zhang \textit{et al.}~\cite{LRT}. This method has shown better performance than \gls{CCA} method and similar performance to \gls{LASSO} method~\cite{LRT}.
	\item \Gls{MPCC} method introduced by Tong \textit{et al.}~\cite{MPCC}.
	\item Dual-frequency \gls{SSVEP} methods~\cite{dual1, dual2}.
\end{itemize}

In this thesis, Emotiv EPOC is used to record brain activity. Article by Liu \textit{et al.}~\cite{emotiv_11hz} also describes a \gls{BCI} that used Emotiv EPOC for recording brain activity using \gls{CCA} method. 
%This thesis focuses on two of these methods: \gls{PSDA} and \gls{CCA} methods.

\gls{CCA} and \gls{PSDA} comparison~\cite{cca_psda, bin2009cca, cca_lin}. \gls{CCA} improvement multiway \gls{CCA}~\cite{mcca}. Multiway \gls{CCA} has shown slightly better performance than standard \gls{CCA} method.

\section{SSVEP-based brain-computer interface}
\label{sec:SSVEP_detection}
The aim of this chapter is to give overview of two methods used to detect \glspl{SSVEP} in \gls{EEG} recording. 
This section describes the \gls{PSDA} and \gls{CCA} method. These are the methods used in chapter~\ref{sec:SSVEP_BCI} for designing application for controlling a robot. 

\subsection{Power spectral density analysis}

Power Spectral density (PSD) analysis is widely used in \gls{SSVEP}-based \glspl{BCI}~\cite{bin2009cca}.

\subsection{Canonical correlation analysis}

\Gls{CCA} was first introduced by Harold Hotelling in 1936~\cite{cca_hotelling}. In 2001 \gls{CCA} was used to introduce a novel method for detecting neural activity in \gls{fMRI} data~\cite{cca_fmri}. Likewise, \gls{CCA} was introduced to \gls{EEG} recording analysis for the first time in 2007~\cite{cca_lin}. 

\Gls{CCA} is statistical method that can be used when analysing two sets of data. In \gls{SSVEP}-based \glspl{BCI} one set of data is the multichannel \gls{EEG} recording. For example, if recording data with electrodes located in O1 and O2, the recorded data can be represented with canonical variable~$X=x_{O1}+x_{O2}$. The second set of data is ...
